(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(t=n.currentScript.src),!t)){var r=n.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=r[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=e.p+"images/logo.fc3e6875d825f899a98d.svg";function n(e,t,n,r,o){var a=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card"),i=a.querySelector(".card__image"),c=a.querySelector(".card__title"),l=a.querySelector(".card__delete-button"),u=a.querySelector(".card__like-button"),s=a.querySelector(".card__like-count");i.src=e.link,i.alt=e.name,c.textContent=e.name,s&&e.likes&&(s.textContent=e.likes.length);var d=e.likes&&e.likes.some(function(e){return e._id===t});return d?u.classList.add("card__like-button_is-active"):u.classList.remove("card__like-button_is-active"),l&&(e.owner&&e.owner._id===t?(l.style.display="block",l.addEventListener("click",function(){n(e._id,a)})):l.style.display="none"),i.addEventListener("click",function(){o(e)}),u.addEventListener("click",function(){r(e._id,u,s,d)}),a}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}}function i(e){var t=document.querySelector(".popup_type_image"),n=t.querySelector(".popup__image"),o=t.querySelector(".popup__caption");n.src=e.link,n.alt=e.name,o.textContent=e.name,r(t)}function c(e){var t=e.querySelector(".popup__close");t&&t.addEventListener("click",function(){o(e)}),e.addEventListener("click",function(t){t.target===e&&o(e)})}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".header__logo");e&&(e.src=t)});var l=/^[a-zA-Zа-яА-ЯёЁ\s-,]+$/;function u(e,t,n,r){e&&t&&(e.textContent=n,e.classList.add(r.errorClass),t.classList.add(r.inputErrorClass))}function s(e,t,n){e&&t&&(e.textContent="",e.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass))}function d(e,t){var n=e.querySelectorAll(t.inputSelector),r=e.querySelectorAll(".".concat(t.errorClass)),o=e.querySelector(t.submitButtonSelector);n.forEach(function(e){e.classList.remove(t.inputErrorClass)}),r.forEach(function(e){e.textContent="",e.classList.remove(t.errorClass)}),o&&(o.disabled=!0,t.inactiveButtonClass&&o.classList.add(t.inactiveButtonClass))}function f(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(function(t){!function(e,t){var n={"edit-profile":[{name:"name",type:"text",minLength:2,maxLength:40},{name:"description",type:"text",minLength:2,maxLength:200}],"new-place":[{name:"place-name",type:"text",minLength:2,maxLength:30},{name:"link",type:"url"}],"edit-avatar":[{name:"avatar",type:"url"}]}[e.getAttribute("name")];n&&function(e,t,n){var r=e.querySelector(t.submitButtonSelector);if(r){var o=n.map(function(a){var i=e.querySelector('input[name="'.concat(a.name,'"]'));if(!i)return null;var c,d=i.nextElementSibling;return d&&d.classList.contains("popup__error")?(c="url"===a.type?function(e){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.value.trim(),a=e.dataset.errorMessage||"Вы пропустили это поле.",i=e.dataset.urlError||"Введите адрес сайта.";return 0===o.length?(r?u(t,e,a,n):s(t,e,n),!1):e.validity.valid?(s(t,e,n),!0):(u(t,e,i,n),!1)}(i,d,t,e)}:function(e){return function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=e.value.trim(),c=e.dataset.errorMessage||"Вы пропустили это поле.",d=e.dataset.patternError||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return 0===i.length?(a?u(t,e,c,n):s(t,e,n),!1):i.length<r||i.length>o?(u(t,e,e.dataset.lengthError||"Должно быть от ".concat(r," до ").concat(o," символов"),n),!1):l.test(i)?(s(t,e,n),!0):(u(t,e,d,n),!1)}(i,d,t,a.minLength,a.maxLength,e)},i.addEventListener("input",function(){var e=c(!0),i=o.filter(function(e,t){return e&&t!==n.indexOf(a)}).map(function(e){return e(!1)}),l=e&&i.every(function(e){return e});r.disabled=!l,t.inactiveButtonClass&&(l?r.classList.remove(t.inactiveButtonClass):r.classList.add(t.inactiveButtonClass))}),i.addEventListener("blur",function(){var e=c(!0),i=o.filter(function(e,t){return e&&t!==n.indexOf(a)}).map(function(e){return e(!1)}),l=e&&i.every(function(e){return e});r.disabled=!l,t.inactiveButtonClass&&(l?r.classList.remove(t.inactiveButtonClass):r.classList.add(t.inactiveButtonClass))}),c):null}).filter(function(e){return null!==e});e._validators=o,e._validationConfig=t}}(e,t,n)}(t,e)})}function p(e){return!(!e._validators||!e._validationConfig)&&function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.querySelector(t.submitButtonSelector);if(!o)return!1;var a=!0;return n.forEach(function(e){e(r)||(a=!1)}),o.disabled=!a,t.inactiveButtonClass&&(a?o.classList.remove(t.inactiveButtonClass):o.classList.add(t.inactiveButtonClass)),a}(e,e._validationConfig,e._validators,!0)}var m={baseUrl:"https://nomoreparties.co/v1/".concat("higher-front-back-dev"),headers:{authorization:"483a3b1b-c5d9-4bf7-9a91-8ca9e54e8e28","Content-Type":"application/json"}};function v(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".profile__edit-button"),t=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__image-edit-button"),l=document.querySelector(".popup_type_edit"),u=document.querySelector(".popup_type_new-card"),s=document.querySelector(".popup_type_image"),_=document.querySelector(".popup_type_delete-card"),b=document.querySelector(".popup_type_edit-avatar"),g=document.querySelector('form[name="edit-profile"]'),S=document.querySelector('form[name="new-place"]'),C=document.querySelector('form[name="edit-avatar"]'),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),k=document.querySelector(".places__list"),x=null,B=null,w=null;function A(e,t){B=e,w=t,r(_)}function T(e,t,n,r){var o=r?function(e){return fetch("".concat(m.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:m.headers}).then(v)}(e):function(e){return fetch("".concat(m.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:m.headers}).then(v)}(e);o.then(function(e){e.likes.some(function(e){return e._id===x})?t.classList.add("card__like-button_is-active"):t.classList.remove("card__like-button_is-active"),n&&e.likes&&(n.textContent=e.likes.length)}).catch(function(e){console.log(e)})}f(y),e.addEventListener("click",function(){var e=g.elements.name,t=g.elements.description;e.value=L.textContent,t.value=E.textContent,d(g,y),g._validators&&g._validators.forEach(function(e){e(!1)}),r(l)}),t.addEventListener("click",function(){d(S,y),r(u)}),a.addEventListener("click",function(){d(C,y),r(b)}),g.addEventListener("submit",function(e){if(e.preventDefault(),p(g)){var t=g.querySelector(y.submitButtonSelector),n=t.textContent,r=g.elements.name,a=g.elements.description,i=r.value.trim(),c=a.value.trim();t.textContent="Сохранение...",t.disabled=!0,function(e,t){return fetch("".concat(m.baseUrl,"/users/me"),{method:"PATCH",headers:m.headers,body:JSON.stringify({name:e,about:t})}).then(v)}(i,c).then(function(e){L.textContent=e.name,E.textContent=e.about,o(l)}).catch(function(e){console.log(e)}).finally(function(){t.textContent=n,t.disabled=!1})}}),S.addEventListener("submit",function(e){if(e.preventDefault(),p(S)){var t=S.querySelector(y.submitButtonSelector),r=t.textContent,a=S.elements["place-name"],c=S.elements.link,l=a.value.trim(),s=c.value.trim();t.textContent="Сохранение...",t.disabled=!0,function(e,t){return fetch("".concat(m.baseUrl,"/cards"),{method:"POST",headers:m.headers,body:JSON.stringify({name:e,link:t})}).then(v)}(l,s).then(function(e){var t=n(e,x,A,T,i);k.prepend(t),S.reset(),d(S,y),o(u)}).catch(function(e){console.log(e)}).finally(function(){t.textContent=r,t.disabled=!1})}}),C.addEventListener("submit",function(e){if(e.preventDefault(),p(C)){var t=C.querySelector(y.submitButtonSelector),n=t.textContent,r=C.elements.avatar.value.trim();t.textContent="Сохранение...",t.disabled=!0,function(e){return fetch("".concat(m.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:m.headers,body:JSON.stringify({avatar:e})}).then(v)}(r).then(function(e){q.style.backgroundImage="url('".concat(e.avatar,"')"),o(b)}).catch(function(e){console.log(e)}).finally(function(){t.textContent=n,t.disabled=!1})}});var U=_.querySelector(".popup__button_type_confirm");U.addEventListener("click",function(){if(B){var e=U.textContent;U.textContent="Удаление...",U.disabled=!0,(t=B,fetch("".concat(m.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:m.headers}).then(v)).then(function(){w&&w.remove(),o(_),B=null,w=null}).catch(function(e){console.log(e)}).finally(function(){U.textContent=e,U.disabled=!1})}var t}),c(l),c(u),c(s),c(_),c(b),Promise.all([fetch("".concat(m.baseUrl,"/users/me"),{headers:m.headers}).then(v),fetch("".concat(m.baseUrl,"/cards"),{headers:m.headers}).then(v)]).then(function(e){var t,r,o=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],c=o[1];x=a._id,L.textContent=a.name,E.textContent=a.about,q.style.backgroundImage="url('".concat(a.avatar,"')"),function(e,t){e.forEach(function(e){var r=n(e,t,A,T,i);k.appendChild(r)})}(c,a._id)}).catch(function(e){console.log(e)})})})();